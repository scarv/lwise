# Copyright (C) 2021 SCARV project <info@scarv.org>
#
# Use of this source code is restricted per the MIT license, a copy of which 
# can be found at https://opensource.org/licenses/MIT (or should be included 
# as LICENSE.txt within the associated archive or repository).

#--------------------------------------------------------------------
# Sources
#--------------------------------------------------------------------
include ${REPO_HOME}/src/hardware/rtl/rv32/Makefile.in
include ${REPO_HOME}/src/hardware/rtl/rv64/Makefile.in

#--------------------------------------------------------------------
# Build emulator
#--------------------------------------------------------------------
ROCKET = freechips.rocketchip.system
MODEL  = SCARVRocketTest 
COP_CONF64 = SCARVRocketCoPConf64
COP_CONF32 = SCARVRocketCoPConf32

XALU_CONF32 = SCARVRocketXALUConf32
XALU_CONF64 = SCARVRocketXALUConf64

export EMULATOR = ${REPO_HOME}/build/$(ISE)_emulator$(subst rv,,$(ARCH))

# Notes: building emulator requires RISCV tool supporting the fesvr package
#        building RISCV gnu-gcc toolchain for 64 bit rocketchip requires option: --with-cmodel=medany

emulator : $(EMULATOR)

${REPO_HOME}/build/cop_emulator64 : $(rtl64_src)
	$(MAKE) -C $(ROCKETCHIP_REPO)/emulator CONFIG=$(COP_CONF64) MODEL=$(MODEL) ISE_RTL=$(RTL64) debug
	cp $(ROCKETCHIP_REPO)/emulator/emulator-$(ROCKET)-$(COP_CONF64)-debug  $@

${REPO_HOME}/build/cop_emulator32 : $(rtl32_src)
	$(MAKE) -C $(ROCKETCHIP_REPO)/emulator CONFIG=$(COP_CONF32) MODEL=$(MODEL) ISE_RTL=$(RTL32) debug
	cp $(ROCKETCHIP_REPO)/emulator/emulator-$(ROCKET)-$(COP_CONF32)-debug  $@

${REPO_HOME}/build/xalu_emulator32 : $(rtl32_src)
	$(MAKE) -C $(ROCKETCHIP_REPO)/emulator CONFIG=$(XALU_CONF32) MODEL=$(MODEL) ISE_RTL=$(RTL32) debug
	cp $(ROCKETCHIP_REPO)/emulator/emulator-$(ROCKET)-$(XALU_CONF32)-debug  $@

${REPO_HOME}/build/xalu_emulator64 : $(rtl64_src)
	$(MAKE) -C $(ROCKETCHIP_REPO)/emulator CONFIG=$(XALU_CONF64) MODEL=$(MODEL) ISE_RTL=$(RTL64) debug
	cp $(ROCKETCHIP_REPO)/emulator/emulator-$(ROCKET)-$(XALU_CONF64)-debug  $@

  


